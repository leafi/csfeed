From Pencil.Gaming. Refactored, .net core compat.